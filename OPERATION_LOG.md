# AION2 Dashboard - 操作日志

## 2026-02-15

### 工坊 Phase 3 收口（图标映射与缓存机制）
- 新增工坊图标缓存持久化：
  - `workshop-store` 默认状态新增 `iconCache`。
  - 以“标准化物品名 -> 图标键”方式保存并复用图标映射。
- 图标解析链路统一为“显式图标 > 缓存命中 > 规则推断”：
  - 手动新增/更新物品（`upsertWorkshopItem`）。
  - OCR 自动补建物品（`importWorkshopOcrPrices`）。
  - 目录导入物品与隐式补建材料（`applyCatalogData`）。
- 目录导入中，若配置了别名（`別名:`），会将别名同步写入图标缓存，减少后续同类物品重复推断。
- 状态归一化阶段加入图标回填：
  - 对历史缺失图标项自动按缓存/推断补齐。
  - 写入时统一刷新缓存，避免后续漂移。

### 工坊 Phase 3.1（交易行行模板图标抓取）
- OCR 导入新增可选 `iconCapture` 参数（截图路径 + 行模板几何参数）：
  - 首行 Y / 行高
  - 名称锚点 X
  - 图标左偏移 + 上偏移
  - 图标窗口宽高
- 主进程按“第 N 行名称 -> 左侧固定窗口”批量裁图并生成图标哈希键（`icon-img-*`），自动回填到物品图标。
- OCR 面板新增图标抓取配置区与导入回显：
  - 图标抓取成功数
  - 图标跳过数
  - 抓取警告列表（越界/路径无效等）

### 工坊 OCR 实测链路补齐（截图直接识别文本）
- 新增后端 OCR 接口：`extractWorkshopOcrText(imagePath, language, psm)`。
  - 通过本机 `tesseract` 命令直接识别截图文本。
  - 默认语言 `chi_tra+eng`，默认 `psm=6`，失败时可回退 `eng`。
- 新增 IPC / preload 通道：`workshop:extract-ocr-text`。
- 工坊 UI 新增“从截图识别文本”入口：
  - 填写截图路径、语言、PSM 后一键识别。
  - 识别结果自动写入 OCR 导入文本框，随后可直接执行价格导入。
- 图标抓取参数新增预设：
  - 交易行 1080p
  - 交易行 1440p
  - 自定义
- 环境探测结果：
  - 本机已检测到 `tesseract v5.5.0.20241111`。
  - 可用语言包：`chi_tra`, `eng`, `osd`。

### 快捷抓价 + 可视化校准（效率链路）
- 新增全局快捷键抓价管线：
  - 热键触发后自动执行：屏幕截取 -> OCR 识别 -> 价格导入。
  - 支持启用/关闭热键、立即手动触发一次、结果回传到 UI。
  - 默认快捷键：`CommandOrControl+Shift+F8`（可自定义）。
- 新增屏幕预览捕获与可视化校准：
  - 一键捕获当前屏幕预览图。
  - 在预览图上叠加图标抓取窗口（按当前参数实时显示），用于校准 `X/Y/宽高`。
- Windows 热键默认值调整为 `Shift+F8`（可自定义）。
- 交易行专用 OCR 截取模式接入（按坐标双框识别并自动拼接“名称 + 价格”）：
  - 名称框：`(426, 310, 900, 960)`
  - 价格框：`(1900, 240, 580, 1030)`
  - 行数：`7`
  - 默认价格列：左侧（可切换右侧）
- 交易行 OCR 解析增强：
  - 价格区优先使用 `TSV + 坐标分行` 解析，减少“有字但无价格”的情况。
  - 当 TSV 结果不足时自动回退到普通文本行解析，并给出告警。
- 手动触发抓价/校准截图支持“延迟 + 截图前自动隐藏程序”，避免程序遮挡游戏界面导致截错。
- 预览中的小内框明确标注为“首行图标窗口”（仅用于图标抓取校准）。
- 新增 IPC / preload 通道：
  - `workshop:configure-ocr-hotkey`
  - `workshop:get-ocr-hotkey-state`
  - `workshop:trigger-ocr-hotkey-now`
  - `workshop:capture-screen-preview`
  - 事件：`workshop:ocr-hotkey-result`

### 工坊 Phase 4 首版（趋势建议：进货点 / 出货点）
- 在现有 `Phase 2.3` 信号基础上新增趋势标签：
  - `buy-zone`（进货点）
  - `sell-zone`（出货点）
  - `watch`（观察）
- 信号计算扩展为双口径判断：
  - 最新价相对“同星期均价”偏离率
  - 最新价相对 `MA7` 偏离率
- 规则与触发口径更新：
  - 样本数 `< 5` 自动降级为 `watch`，避免小样本噪声。
  - `triggered` 保持“进货点触发”语义（规则开启时）。
- 工坊行情中心 UI 增强：
  - `Phase 2.3` 卡片新增 `MA7` 指标与 `MA7偏离` 展示。
  - 新增 `Phase 4` 双栏列表（进货点 / 出货点），支持按偏离强度查看候选物品。
  - 新增汇总指标：`buyZoneCount`、`sellZoneCount`。

### 兼容确认
- 内置目录文件名保持为 `制作管理.md`（即旧 `采集材料、鐵匠.md` 的新命名）。

### 本次校验
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

## 2026-02-14

### 工坊 Phase 2.2 开发进度（行情中心 UI）
- 将工坊页原“Phase 2.1 数据验证面板”升级为“Phase 2.2 行情中心: 价格曲线视图”。
- 新增价格历史快捷筛选：
  - 7 / 14 / 30 / 90 天一键查询。
  - 保留手动输入天数查询。
- 新增曲线图可视化（基于现有 `workshop:get-price-history` 数据）：
  - 实际价格曲线（青线）。
  - MA7 曲线（黄线）。
  - 周三重置日标记线（黄虚线）。
- 新增行情关键指标卡：
  - 样本数、最新价、区间均价、MA7(最新)。
  - 周内均价偏离率（最新价相对“同星期均价”偏离）。
  - 最新采样时间。
- 保留并展示按星期几均价明细（周日到周六）。
- 预留 Phase 2.3 规则入口：
  - 新增“低于周内均值阈值提示”的阈值输入与触发预览（仅预览，不写入规则引擎）。

### 本次校验
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

### 工坊 Phase 2.3 开发进度（周期性波动提示）
- 新增后端规则配置模型（持久化到工坊 store）：
  - `signalRule.enabled`
  - `signalRule.lookbackDays`
  - `signalRule.dropBelowWeekdayAverageRatio`
- 新增工坊信号类型与结果结构：
  - `WorkshopPriceSignalRule`
  - `WorkshopPriceSignalQuery`
  - `WorkshopPriceSignalRow`
  - `WorkshopPriceSignalResult`
- 新增 IPC 与 preload API：
  - `workshop:get-price-signals`
  - `workshop:update-signal-rule`
- 后端实现：
  - `getWorkshopPriceSignals()`：对全物品按“最新价 vs 同星期均价”计算偏离率，并按阈值输出触发行情提示。
  - `updateWorkshopSignalRule()`：保存规则配置并统一做边界钳制（天数/阈值）。
  - 价格历史计算逻辑抽出复用，确保 `Phase 2.1/2.2/2.3` 口径一致。
- 前端接入（工坊 Phase 2.2 面板内）：
  - 将 Phase 2.3 从“预留预览”升级为“可保存规则”。
  - 支持开启/关闭规则、设置回看天数、设置阈值%、保存并刷新信号。
  - 展示触发结果清单（物品、最新价、同星期均价、偏离率、最新采样时间、样本数）。
  - 非触发场景与规则关闭场景给出明确提示文案。

### 本次校验（Phase 2.3）
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

### 工坊 Phase 3.0 开发进度（半自动抓价 / OCR 导入优先）
- 新增 OCR 粘贴导入能力（半自动抓价首版）：
  - 输入方式：多行文本，每行“物品名 + 价格（行尾）”。
  - 价格 OCR 容错：支持常见分隔符与 `O/o -> 0`、`I/l -> 1` 误识别修正。
  - 导入结果回显：成功条数、新增物品数、未匹配物品、异常行列表。
- 新增后端导入协议与接口：
  - 类型：`WorkshopOcrPriceImportInput`、`WorkshopOcrPriceImportResult`
  - IPC：`workshop:import-ocr-prices`
  - API：`importWorkshopOcrPrices(payload)`
- 导入策略：
  - 默认写入 `source=import` 价格快照。
  - 支持“缺失物品自动创建（材料分类）”开关。
  - 自动创建物品时补充图标键推断（作为图标映射缓存基础）。
- 工坊页新增“Phase 3 半自动抓价: OCR 粘贴导入”面板，已接入全链路。

### 本次校验（Phase 3.0）
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

### 工坊数据底座录入（采集材料、鐵匠）
- 新增“目录文件导入”能力，支持从项目内文本文件批量导入工坊物品与配方：
  - IPC: `workshop:import-catalog-from-file`
  - API: `importWorkshopCatalogFromFile({ filePath })`
- 已实现 `采集材料、鐵匠.md` 对应的解析与录入逻辑：
  - 自动识别“物品段 / 配方段”。
  - 按分类映射到工坊类别（採集材料/製作材料/武器/裝備等）。
  - 解析材料明细中 `名稱*數量` 与 `名稱數量` 两种写法。
  - 对同产物重复配方做跳过并记录 warning（避免覆盖冲突）。
  - 缺失材料名自动补建物品，保证配方可落库。
- 工坊页新增按钮：`导入采集材料、鐵匠`
  - 导入后即时回显：物品数、配方数、隐式补建数、跳过数与 warning。
- 为后续继续录入其他职业/分类文件打通了复用入口（同格式可继续导入）。

### 本次校验（目录导入）
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

### 工坊录入策略调整（按最新确认）
- 移除工坊页顶部“`一键导入样例`”与“`导入采集材料、鐵匠`”按钮，避免用户侧手工导入路径。
- 工坊数据改为“内置目录启动重建”模式：
  - `WORKSHOP_STATE_VERSION` 升级到 `2`。
  - 当检测到旧版本或空目录时，自动读取项目根目录 `采集材料、鐵匠.md`，按规则重建物品与配方。
  - 该重建会覆盖旧工坊目录数据（物品/配方），用于清理历史样例和旧录入。
- 移除前端“配方录入”卡片（用户不再手动维护配方）。
- 制作模拟器增强：
  - 在模拟材料表中支持直接编辑“库存/单价”。
  - 新增按钮“保存单价/库存并重算”。
  - 保存后写入现有价格快照与库存链路，并立即重算结果（与未来 OCR 导价链路兼容）。

### 本次校验（策略调整）
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

## 2026-02-09

### 今日完成
- 完成 Electron + React + Vite + TypeScript 基础框架搭建，形成可持续迭代结构。
- 实现本地持久化（`electron-store`）与 `main/preload/renderer/shared` 分层。
- 建立配置驱动任务模型（`TaskDefinition`），支持后续按配置扩展任务。
- 实现奥德能量双池模型：
  - 自然能量：`xx/840`（每 3 小时 +15，自然恢复）
  - 补充能量：`(+yyyy)`（当前上限已改为 `+2000`）
  - 扣减顺序：先扣基础，再扣补充
- 实现关键自动刷新规则：
  - 每日 05:00 刷新
  - 每周三 05:00 刷新
  - 远征次数时段补充（04:00 / 12:00 / 20:00）
  - 超越次数时段补充（03:00 / 15:00）
  - 恶梦每日 +2（上限 14）
- 完成打卡交互重构（移除 prompt 的不稳定方案）：
  - 任务完成次数（支持输入）
  - 吃券 +1
  - 录入已完成（用于指令书类）
  - 失败时弹窗内显示明确错误原因（例如奥德不足、次数不足）
- 角色管理功能：
  - 新增角色
  - 重命名角色
  - 删除角色（至少保留 1 个）
- 圣域逻辑重构：
  - 合并为单卡“圣域”
  - 分开管理：挑战次数（4）/ 开箱次数（2，40奥德）
  - 支持手动设定
- 远征/超越手动设定：
  - 基础次数
  - 券次数
  - 首领次数
  - 增加输入说明，避免误解字段含义
- 恶梦/觉醒/讨伐也已支持手动设定（基础次数 + 券次数）。
- 远征 84 次策略改为“警示”而非“硬拦截”：
  - 超过 84 后继续允许挑战
  - 提示奖励/金币会折扣

### 当前业务规则状态
- 远征/超越完成次数：逻辑正常，支持多次输入、能量校验、券扣减。
- 远征/超越扣减顺序：基础次数优先扣减，再扣券次数。
- 奥德不足时会给出明确错误提示（已验证）。

### 明日建议优先事项（Phase 3）
1. 增加“操作历史日志 + 撤销一步/多步”。
2. 增加“下一次恢复倒计时”模块（远征/超越/每日/每周重置）。
3. 增加“设置页”：
   - 金币收益参数
   - 次数上限参数（可选）
   - 提示阈值参数（如远征 84 门槛）
4. 增加“数据导出/导入”以便备份与迁移。

### 合作约定
- 后续每次迭代结束，同步更新本文件，确保连续协作不丢上下文。

## 2026-02-10

### 今日完成（Phase 3）
- 增加“操作历史日志 + 撤销一步/多步”：
  - 新增全局操作日志持久化（记录动作、时间、角色、描述、撤销快照）。
  - 绝大多数状态变更都纳入日志（角色管理、任务打卡、手动设定、设置修改、周统计重置、导入）。
  - 新增撤销 API，支持一次撤销 1 步或 N 步。
- 增加“下一次恢复倒计时”模块：
  - 远征恢复倒计时。
  - 超越恢复倒计时。
  - 每日重置倒计时（05:00）。
  - 每周重置倒计时（周三 05:00）。
- 增加“设置页”模块（内嵌在主界面）：
  - 金币收益参数（远征/超越）。
  - 次数上限参数（可选，留空使用默认；用于次数设定与刷新钳制）。
  - 提示阈值参数（远征阈值、超越阈值；远征默认 84）。
- 增加“数据导出/导入”：
  - 导出 JSON 备份（系统保存对话框）。
  - 导入 JSON 备份（系统打开对话框）。
  - 导入后自动写入一条可撤销日志，支持一键回滚导入。

### 结构改动
- `src/shared/types.ts`
  - 扩展 `AppSettings`（金币/上限/阈值）。
  - 增加 `OperationLogEntry`、`AppStateSnapshot`。
  - 扩展 `AppState`（新增 `history`）。
  - 增加导入导出结果类型。
- `src/main/store.ts`
  - 引入统一状态变更提交入口（自动写操作日志）。
  - 新增 `undoOperations` / `updateSettings` / `exportDataToFile` / `importDataFromFile`。
  - 导入导出使用 Electron 文件对话框 + 本地 JSON 文件。
- `src/main/ipc.ts` / `src/shared/ipc.ts` / `src/preload/index.ts`
  - 新增 IPC：撤销、更新设置、导出、导入。
- `src/shared/time.ts`
  - 新增 next tick/reset 计算函数，供倒计时模块使用。
- `src/shared/engine.ts`
  - 任务进度显示支持读取设置中的可选次数上限。
- `src/renderer/src/App.tsx`
  - 新增倒计时卡片、操作历史列表、撤销入口、设置参数面板、导入导出按钮。
  - 远征预警阈值改为可配置读取。

### 校验
- 已执行 `npm run typecheck`，通过。

## 2026-02-15

### 今日完成（工坊 OCR Phase 3 收口）
- 双价格抓取链路打通：
  - 交易行 `priceMode=dual` 下按左右半区分别 OCR，避免把 `200 + 200` 识别成 `200200`。
  - 导入阶段优先使用结构化 `tradeRows`，同一行可同时写入“伺服器价 / 世界价”两条快照。
  - 价格快照新增 `market` 标签（`server/world/single`），导入明细可直接看到市场来源。
- 双价格列角色自动识别：
  - 新增“价格表头 OCR 自动判定”逻辑，优先识别左/右列是伺服器还是世界。
  - 识别失败时回退到手动预设，并给出警告。
- 严格写入模式上线：
  - 新增 `strictIconMatch`（名称 + 图标同时通过才写入）。
  - 严格模式下，若无图标抓取/无图标基线/图标不匹配会明确跳过并提示原因，避免误写。
- 图标抓取稳定性修复：
  - 图标按 `lineNumber` 计算行位，不再因双价格展开导致图标行错位。
  - 行内多价格（server/world）共享同一行图标，不重复错抓。
- 前端控制与可见性补齐：
  - 新增价格模式、左右列角色、严格校验开关。
  - 快捷抓价与手动导入明细表新增“市场”列，能看出写入的是伺服器价还是世界价。

### 校验
- 已执行 `npm run typecheck`，通过。

## 2026-02-15

### 工坊 Phase 3 调试收敛（OCR/热键/校准）
- 交易行 OCR 行对齐修复：
  - TSV 解析改为“按固定行索引保留空位”再合并，避免因空行过滤导致名称/价格错位。
  - 当 TSV 合并行数不足时自动回退普通文本行解析，并输出明确告警。
- 价格识别鲁棒性增强：
  - 数字标准化新增常见 OCR 混淆字符映射（如 `O/I/S/B`）。
  - 行尾价格与价格列提取逻辑统一复用数字标准化，减少“识别到但解析失败”。
- 热键诊断增强：
  - 快捷键输入标准化（容错空格/全角加号/常见别名）。
  - Windows 下注册失败时自动尝试多候选组合，并记录“已尝试列表”到结果告警。
  - 快捷抓价结果消息改为展示“识别行/导入条数/未匹配/异常行”。
- 前端调试可视化增强：
  - 快捷抓价结果新增调试统计与告警明细面板。
  - 可视化校准区域改为常驻显示，图标窗口预览改为按行展开，减少首行小框误解。
  - 默认“缺失物品自动创建(材料)”调整为开启，便于快速验证 OCR 链路。

### 校验
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

### 工坊 Phase 3 二次修正（按实机反馈）
- 热键抓价结果新增“明细输出”：
  - 展示本次导入的行号、物品名、价格、时间、是否新增物品。
  - 手动 OCR 导入结果同样支持明细查看。
- 安全策略回调：
  - 默认关闭“缺失物品自动创建”。
  - 热键状态加载时同步回填该开关，避免误判当前策略。
- 历史/价格维护可见性增强：
  - 价格修正表新增“最新时间”列。
  - 当前选中物品显示“最新价 + 库存 + 最新时间”。
  - 行情中心新增“最近抓价更新（最新20条）”面板。
- 图标抓取模板按用户坐标更新：
  - 首图左上角 `(444,423)`，图标尺寸 `85x85`，行间隔 `52`。
  - 名称锚点默认更新为 `529`（配合 `iconOffsetX=-85` 对齐到 `x=444`）。
  - 校准名称框时不再自动改写图标行高/首行，防止覆盖图标参数。
- 本地数据修复：
  - 已清理 5 条 OCR 误新增物品及其价格快照（用户 AppData 数据文件）。

### 工坊 Phase 3 三次修正（OCR 精度 + 图标校准固定）
- 图标校准行为调整：
  - 图标参数固定为 `85x85`、行间隔 `52`。
  - 拖拽“图标框”时仅更新首行坐标，不再改写尺寸与行高。
- OCR 抗噪增强：
  - 物品名新增清洗规则（去引号/符号/首尾噪声字符）。
  - 导入匹配新增多级兜底：精确匹配 -> 包含匹配 -> 编辑距离模糊匹配（阈值控制）。
  - 交易行名称区 OCR 调整为优先中文语言包，并将名称区放大倍数提升到 `2x`。
  - 交易行行合并前对名称再次清洗，降低“前缀噪声导致未匹配”概率。
- 热键告警文案调整：
  - 未匹配提示改为“先校准与提高清晰度”，避免误导开启自动新增。

### 工坊 Phase 3 四次修正（图标步进修正 + 高精度防误匹配）
- 图标抓取参数按最新实测更新：
  - 首图左上角默认 `(445,339)`（由 `nameAnchorX=530`、`iconOffsetX=-85` 推导）。
  - 图标固定 `85x85`。
  - 行步进固定 `135`（等效图标间隔 `50`）。
- 物品匹配策略改为“宁缺毋滥”：
  - 引入图标唯一匹配兜底（当图标能唯一指向物品时优先使用）。
  - 当“名称匹配结果”和“图标匹配结果”冲突时，直接标记冲突并跳过，不写入价格。
  - 对“短名被长名覆盖”的高歧义场景（如 `蓝宝石原石` vs `纯净的蓝宝石原石`）默认跳过，避免误写入。

## 2026-02-14

### 今日完成（工坊主线：内置库 + 行情 + 模拟 + 背包工作台）
- 工坊数据能力扩展：
  - 增加目录文本导入与 OCR 价格导入链路（含自动创建缺失材料选项）。
  - 增加价格快照删除能力，用于误操作修正。
  - 增加周期波动信号规则（按星期均价偏离阈值触发）。
- 工坊分类与排序对齐：
  - 物品/配方支持大类+下级分类筛选（鐵匠 / 盔甲 / 手工藝 / 煉金 等）。
  - 制作模拟、行情中心、价格管理统一分类口径与排序逻辑。
- UI 结构重构为三段工作台：
  - `1) 市场工作台`：OCR 抓价 + 行情中心 + 波动信号。
  - `2) 制作模拟器（单配方）`：单配方成本/利润测算，材料行内可改库存与单价。
  - `3) 背包与补差工作台`：全局价格/库存修正 + 背包逆向推导 + 差一点可做。
- 右侧操作中心新增“历史价格管理”卡片：
  - 支持大类/小类/物品/关键词筛选。
  - 支持删除指定快照并即时生效。

### 结构改动
- `src/main/workshop-store.ts`
  - 升级工坊状态版本，新增 `signalRule`、目录导入/OCR 导入/信号分析/快照删除等核心逻辑。
- `src/shared/types.ts`
  - 新增工坊行情信号、OCR 导入、目录导入等类型定义。
- `src/shared/ipc.ts` / `src/main/ipc.ts` / `src/preload/index.ts`
  - 新增 IPC：`importWorkshopOcrPrices`、`importWorkshopCatalogFromFile`、`getWorkshopPriceSignals`、
    `updateWorkshopSignalRule`、`deleteWorkshopPriceSnapshot`。
- `src/renderer/src/WorkshopView.tsx`
  - 重构工坊页面为三段工作台，完成分类筛选、行情图、信号配置、模拟器与背包工作台整合。
- `src/renderer/src/WorkshopSidebarHistoryCard.tsx`（新增）
  - 右侧历史价格管理 UI，支持筛选与删除。
- `src/renderer/src/App.tsx`
  - 在 `workshop` 模式挂载右侧历史价格管理卡片。

### 校验
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

## 2026-02-13（收口）

### 今日收口进度（工坊主线）
- Phase 1 已可用：
  - 物品/价格/库存录入
  - 配方录入（支持套娃）
  - 制作模拟（税后收入、净利润、利润率、缺口）
  - 背包逆向推导
- Phase 1.1 已完成：
  - 一键导入样例数据（`样例-*`）
  - 运行时兼容提示（旧 preload 场景）
- Phase 1.2 已完成：
  - “差一点可做”补差预算建议
  - 排序策略切换：
    - 最高预算利润优先
    - 最低补差成本优先
- Phase 2.1 已开工并完成数据层：
  - 价格历史查询（按物品 + 天数/区间）
  - 指标：`MA7`、区间均价、按星期几均价、最新价
  - 工坊页新增数据验证面板（用于先验算数据正确性）

### 今日提交记录
- `10bd296` `feat: workshop phase1.2 budget suggestions and responsive fixes`
- `1d46408` `feat: add phase1.2 near-craft sorting strategies`
- `747407f` `feat: add workshop phase2.1 price history metrics foundation`

### 当前状态
- `npm run typecheck` 通过
- `npm run build` 通过

### 明日开工清单（建议顺序）
1. Phase 2.2：行情中心 UI（价格曲线视图）
2. 接入时间筛选（7/14/30/90 天）和“周三重置日”标记线
3. 在曲线页显示关键数值卡：最新价、MA7、周内均价偏离率
4. 预留 Phase 2.3 规则入口（低于均值 X% 的提示文案）

## 2026-02-13

### 工坊模块启动（Phase 1）
- 新增工坊框架备忘文件：`WORKSHOP_FRAMEWORK.md`。
- 新增独立工坊业务域：`src/main/workshop-store.ts`。
  - 本地持久化：`aion2-dashboard-workshop`。
  - 支持物品/配方/价格快照/库存管理。
  - 支持套娃配方递归展开、循环检测、税后利润计算、库存缺口计算。
  - 支持背包逆向推导（可制作次数与收益排序）。
- 新增 IPC 与 preload 工坊 API：
  - `workshop:get-state`
  - `workshop:upsert-item`
  - `workshop:delete-item`
  - `workshop:upsert-recipe`
  - `workshop:delete-recipe`
  - `workshop:add-price-snapshot`
  - `workshop:upsert-inventory`
  - `workshop:simulate-craft`
  - `workshop:get-craft-options`
- 新增 UI 面板：`src/renderer/src/WorkshopView.tsx`。
  - 物品/价格/库存录入
  - 配方录入
  - 制作模拟器（税后利润、材料缺口）
  - 背包可制作推荐
- `src/renderer/src/App.tsx` 新增“工坊”页签入口。

### 工坊验证增强（Phase 1.1）
- 新增样例数据导入能力（幂等导入，避免重复脏数据）:
  - IPC 通道: `workshop:seed-sample-data`
  - 主进程: `seedWorkshopSampleData()`
  - preload: `seedWorkshopSampleData()`
  - UI: 工坊页新增“一键导入样例”按钮
- 样例内容采用 `样例-*` 命名前缀，避免和真实物品重名冲突，覆盖链路包括:
  - 样例物品
  - 套娃配方（基础材料 -> 中间件 -> 成品装备）
  - 样例价格快照
  - 样例库存
- 目的: 点击一次即可直接验证 Phase 1 全流程计算（成本、税后利润、缺口、可制作推荐）。
- 运行时兼容兜底:
  - 若用户在旧 preload 实例中点击“一键导入样例”，前端不再抛 `is not a function` 异常；
  - 改为明确提示“完全退出并重启应用后重试”。

### 校验
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

### 工坊布局修复 + Phase 1.2（补差预算建议）
- 修复工坊页在非最大化窗口时的布局溢出问题：
  - 将固定列模板改为响应式网格（小窗口自动折行）。
  - 输入/下拉统一补充 `min-w-0`，避免内容撑爆卡片。
  - 涉及区域：物品录入、配方录入、模拟器参数区、背包推导头部。
- 新增 Phase 1.2：
  - 新增“差一点可做（补差预算）”模块。
  - 用户输入预算后，输出：
    - 单次补差成本
    - 预算内可补差次数
    - 单次利润
    - 预算内潜在利润
  - 支持材料缺价提示（无法完整估算时标注）。

### 再次校验
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

### Phase 1.2 增强（排序策略切换）
- 在“差一点可做（补差预算）”模块新增排序模式切换：
  - 最高预算利润优先
  - 最低补差成本优先
- 列表排序逻辑支持按模式动态重排，满足不同决策偏好（收益优先 vs 门槛优先）。

### 校验（本次增强）
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

### Phase 2.1 开工（价格历史查询 + 基础指标）
- 新增价格历史查询能力（按物品 + 时间范围）:
  - 新增类型（`src/shared/types.ts`）:
    - `WorkshopPriceHistoryQuery`
    - `WorkshopPriceHistoryResult`
    - `WorkshopPriceHistoryPoint`
    - `WorkshopWeekdayAverage`
  - 新增 IPC（`src/shared/ipc.ts`）:
    - `workshop:get-price-history`
  - 新增 preload API（`src/preload/index.ts`）:
    - `getWorkshopPriceHistory(payload)`
  - 主进程注册（`src/main/ipc.ts`）:
    - `IPC_CHANNELS.getWorkshopPriceHistory`
- 后端实现（`src/main/workshop-store.ts`）:
  - 新增 `getWorkshopPriceHistory(payload)`：
    - 支持 `days` 回看查询；
    - 支持 `fromAt/toAt` 显式区间查询；
    - 结果包含 `MA7`、区间均价、按星期几均价、最新价与样本数。
- 前端验证入口（`src/renderer/src/WorkshopView.tsx`）:
  - 新增“Phase 2.1 数据验证: 价格历史与指标”面板；
  - 可选物品、输入查询天数并拉取历史；
  - 展示样本数、最新价、区间均价、MA7(最新)、星期均价。

### 校验（Phase 2.1）
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

## 2026-02-13（v1.1.0）

### 本次更新
- 新增“奥德能量满溢提醒”：
  - 当角色奥德基础能量 `>800` 时，在优先级待办中加入高优先提醒。
  - 角色页“待办提醒”同步加入 `奥德能量>800，建议清体力` 标签。
- Dashboard 角色概览卡片强化能量可见性：
  - 奥德能量状态调整到角色名称右侧，使用醒目徽标展示 `基础(+补充)/上限`。
  - 统一文案命名为“奥德能量”（移除“奥德自然能量”描述）。
- 修正“回廊刷新”倒计时计算：
  - 由“当天 21:00 推算”修正为“固定 21:00 锚点 + 每 48 小时步进”。
  - 修复特定时段显示错误（如应剩余约 30 小时却显示约 6 小时）。
- 接入 Windows 自动更新（NSIS 安装版）：
  - 引入 `electron-updater`，应用启动后自动检查更新。
  - 新版本下载完成后弹窗提示“立即重启更新/稍后”。
  - 构建脚本区分“仅打包”与“打包并发布到 GitHub Releases”。

### 本次校验
- 已执行 `npm run typecheck`，通过。
- 已执行 `npm run build`，通过。

## 2026-02-12（收尾）

### 今日收官更新（发布前最终整理）
- 首发数据策略已确认：
  - 发布版本首启默认 `空账号 / 空角色`，不再预置任何测试角色信息。
  - 新增空状态引导页，用户首次打开可直接创建第一个账号。
- 桌面壳层优化：
  - 生产环境隐藏 Electron 默认菜单栏，界面保持干净。
  - 开发环境保留菜单栏，方便调试。
- 图标与品牌处理：
  - 将发布图标替换为原创自制图标（非游戏素材）。
  - 打包前自动生成 `build/icon.ico` 并注入安装包/可执行文件图标。
- 打包与发布：
  - 已完成 `npm run dist:win` 构建并验证通过。
  - 已重新覆盖上传 `v1.0.0` Release 资产（Setup/Portable/7z 三件套）。
- 代码与仓库状态：
  - 相关改动已提交并推送到 `main`。
  - 当前可作为 1.0 对外分发版本使用。

### 今日追加（品牌图标 + 首启空状态 + 菜单栏精简）
- 图标接入：
  - 使用仓库根目录 `icon.png` 作为应用图标来源。
  - 新增 `scripts/generate-icon.ps1`，打包前自动生成 `build/icon.ico`。
  - `dist:win` 流程调整为先执行 `prepare:icon`，再 `check:prepackage + electron-builder`。
  - `electron-builder` 配置接入 `build/icon.ico`（安装包/卸载器/可执行文件图标）。
  - 主进程窗口增加 `icon` 路径解析（开发/生产均可加载）。
- 首启数据策略改造：
  - `store` 默认数据从“预置账号+角色”改为“空账号/空角色”。
  - renderer 增加“空状态引导页”，首开时引导先创建第一个账号。
  - 确保最终发给用户时不包含任何预录入角色信息。
- 顶部 Electron 菜单栏：
  - 生产环境下隐藏默认菜单（保留开发环境菜单便于调试）。
  - 非 macOS 平台在生产环境执行 `Menu.setApplicationMenu(null)` 并隐藏菜单栏。
- 打包验证：
  - 已执行 `npm run dist:win`，通过。

### 今日追加（开源 README 整理）
- 作者标识更新为 `SouNd`（用于设置页构建信息展示）。
- 重写 `README.md`，补全以下开源发布必需信息：
  - 项目定位与核心功能总览
  - 关键规则（重置/恢复/回廊刷新）
  - 开发启动、构建与打包前自检命令
  - 数据持久化与自动备份说明
  - 目录结构与常用命令
  - 开源发布前许可证占位说明

### 今日追加（构建信息 + 打包前自检）
- 设置页新增“构建信息”区块：显示 `版本 / 构建时间 / 作者`，便于发布包追踪。
- 新增主进程构建元信息注入链路：
  - `electron.vite.config.ts` 注入 `__APP_VERSION__ / __BUILD_TIME__ / __APP_AUTHOR__`。
  - 新增 `src/shared/build-meta.ts` 统一导出构建元信息。
  - 新增 IPC 通道 `app:get-build-info`，renderer 可直接读取。
- 新增打包前自检脚本：`npm run check:prepackage`
  - 依次执行 `typecheck -> build -> 产物存在性检查`。
  - 校验文件：`out/main/index.js`、`out/preload/index.mjs`、`out/renderer/index.html`。

### 2026-02-12（续：优先级规则与紧急高亮修订）
- 下拉录入视觉优化：
  - `select/option` 统一改为深色底（黑色系）与浅色文字，降低灰底刺眼问题。
- 优先级规则调整（按最新策略）：
  - “每日 5 个使命任务”提升到与回廊同级高优先。
  - “觉醒/讨伐”改为仅在周刷新前提醒；当距离周刷新 `<=48h` 时提升为高优先（接近圣域级别）。
  - “超越/恶梦”溢出提醒保留，但不再使用高亮优先级。
  - “商店-奥德 / 商店-副本券 / 变换-奥德”在周刷新前 `<=48h` 若有剩余可用，进入高优先提醒。
- 角色总览紧急红色高亮：
  - 高亮常驻项：圣域、回廊、每日使命。
  - 周刷新 `<=48h` 高亮项：每日副本、觉醒、讨伐、每周指令，以及商店/变换相关剩余项。
  - 实现为角色卡任务徽标红色紧急态，便于快速定位“最该先打”的内容。

### 本次校验
- 已执行 `npm run typecheck`，通过。

### 2026-02-12（续：微风商店/变换逻辑修正）
- 按最新规则修正：
  - 微风商店：仅记录 `奥德购买`、`每日副本挑战券购买` 两项（每项角色 5，账号额外角色 +8）。
  - 变换：仅记录 `奥德能量变换` 一项（角色 5，账号额外角色 +8）。
  - 删除“变换-副本券”相关字段与 UI。
- 角色操作页拆分为两个独立卡片：
  - `微风商店记录`（两项输入 + 保存 + 额外资格开关）
  - `变换记录`（仅奥德输入 + 保存）
- 总览徽标同步为三项：
  - `商店-奥德`、`商店-副本券`、`变换-奥德`。
- 数据结构与接口同步裁剪：
  - `aodePlan` 仅保留三项：`shopAodePurchaseUsed`、`shopDailyDungeonTicketPurchaseUsed`、`transformAodeUsed`。
  - `character:update-aode-plan` payload 同步去掉 `transformDailyDungeonTicketUsed`。

### 本次校验
- 已执行 `npm run typecheck`，通过。

### 2026-02-12（续：录入防误触与优先级引导）
- 次数录入改造：
  - 将主要“次数录入”从手填输入改为下拉选择，统一范围 `1-100` 或 `0-100`（按场景）。
  - 覆盖场景：
    - 总览“快速录入”数量。
    - 角色页“周次数校准”。
    - 回廊完成次数（设置页与弹窗）。
    - 任务弹窗：完成次数、吃券次数、输入已完成次数、任务手动设定、圣域手动设定。
    - 微风商店/变换卡片中的次数录入。
- Dashboard 优先级待办：
  - 右栏新增“优先级待办（Top 8）”卡片，按收益/溢出/到期综合排序。
  - 当前规则重点：
    - 高优先：圣域、回廊、觉醒、讨伐、周刷新前未清的每日副本与每周指令。
    - 中优先：远征、超越（接近满次会提升优先级）。
    - 低优先：小游戏、精灵入侵。
  - 对“超越/恶梦接近溢出”给出高优先提醒。

### 本次校验
- 已执行 `npm run typecheck`，通过。

### 2026-02-12（续：需求定稿与修正）
- 右侧倒计时展示修正：
  - “每周重置”从小时制改为天级展示：`X天X小时X分X秒`。
  - “回廊统一刷新”同样采用天级展示，并显示目标时间点。
- 深渊回廊刷新规则调整：
  - 上层/下层统一为 `今晚 21:00` 起每 `48` 小时刷新。
  - 设置页与同步弹窗改为仅录入“下层/中层当前可打数量”，不再录入小时/分钟倒计时。
- 角色新增“奥德购买/变换记录”：
  - 每角色基础上限：购买 `5`、变换 `5`。
  - 每账号可指定 1 个“额外角色”：购买 `+8`、变换 `+8`。
  - 角色操作页新增独立卡片：支持手动录入已用次数、显示剩余次数、一键设为/取消额外角色。
  - 总览卡片新增奥德进度展示：购买 `used/limit`、变换 `used/limit`。
  - 周重置时自动清零奥德购买/变换周计数。
- 数据结构与接口：
  - `AccountState` 新增 `extraAodeCharacterId`。
  - `CharacterState` 新增 `aodePlan.weeklyPurchaseUsed / weeklyConvertUsed`。
  - 新增 IPC：`character:update-aode-plan`，并完成 `main/preload/renderer` 全链路接入。
- 状态版本说明修订：
  - 当前 `APP_STATE_VERSION = 7` 用于本次“奥德计划 + 回廊统一刷新”模型；
  - 先前日志中关于 `v7` 与“开始本轮/作战笔记”的描述已不再作为当前实现依据。

### 本次校验
- 已执行 `npm run typecheck`，通过。

### 2026-02-12（续：倒计时样式与微风商店重构）
- 倒计时展示统一：
  - “每周重置”改回 `HH:MM:SS` 风格（与远征/超越一致）。
  - “回廊刷新”同样使用 `HH:MM:SS` 风格。
  - 文案从“回廊统一刷新”改为“回廊刷新”。
- “同步深渊回廊”弹窗精简：
  - 删除说明文案“刷新时间已统一为今晚21:00起每48小时自动推算”。
- 奥德模块重构为“微风商店 + 变换”四项记录（保留每账号 1 个额外角色 +8 机制）：
  - 微风商店：`奥德购买`、`每日副本挑战券购买`
  - 变换：`奥德`、`每日副本挑战券`
  - 四项均按“基础每角色 5 次，额外角色每项 +8 次”校验。
  - 总览卡新增四个进度徽标：商店-奥德、商店-副本券、变换-奥德、变换-副本券。
- 数据结构兼容升级：
  - `aodePlan` 字段从两项扩展为四项：
    - `shopAodePurchaseUsed`
    - `shopDailyDungeonTicketPurchaseUsed`
    - `transformAodeUsed`
    - `transformDailyDungeonTicketUsed`
  - 兼容旧存档：旧字段 `weeklyPurchaseUsed/weeklyConvertUsed` 自动迁移到新结构对应项。
- IPC 与 store 更新：
  - `character:update-aode-plan` payload 扩展为四项计数 + `assignExtra`。
  - 周重置时清空四项周计数。

### 本次校验
- 已执行 `npm run typecheck`，通过。

### 当日微调（总览标签字号）
- 角色总览卡中各项 `当前/总量` 标签（如“每日副本 7/7”）字号小幅上调：
  - `text-[11px]` -> `text-xs`
  - 同步微调标签横向内边距，增强 2K 全屏可读性。

### 当日再调优（2K 全屏空隙与比例）
- 回退“整体容器限宽”方案，改为三栏全宽自适应，避免两侧大面积留白。
- 三栏轨道按大屏分级：
  - `xl`: `300 / 1fr / 340`
  - `2xl`: `340 / 1fr / 400`
- 改用“根字号随分辨率同比例放大”：
  - `>=1900px`: `html font-size = 17px`
  - `>=2500px`: `html font-size = 18px`
- 目的：中栏自适应不空、全屏下信息密度更舒适，保持三栏层级不变。

### 当日再修正（按反馈回撤总览快捷操作）
- 移除总览卡快捷按钮：`+远征券`、`远征-1`、`+超越券`、`超越-1`。
- 总览页保留单一入口“进入角色”，所有操作回归角色界面内处理。
- 保留已完成功能：总览排序/筛选、顶部导航精简、每日首次自动备份。

### 当日继续迭代（统一快速录入选项卡）
- 在“角色总览”顶部新增“快速录入”选项卡：
  - 可选择：角色、内容、动作、次数。
  - 支持动作：完成次数 / 挑战券增加 / 输入已完成（按任务能力自动切换）。
  - 点击“提交录入”后直接写入对应角色与任务进度，无需先进入角色页。
- 交互策略：
  - 不再在每个角色卡放快捷按钮，避免卡片过载。
  - 保留总览卡“进入角色”主路径，快速录入作为上方统一入口。

### 当日追加（周统计次数手动校准）
- 新增“当前角色周次数校准（远征/超越）”输入区：
  - 支持手动填写“远征已完成次数 / 超越已完成次数”并保存。
  - 目标：误清空周统计后，可回填游戏内真实已完成次数，避免统计长期失真。
- 新增 IPC + store 写入链路：
  - `character:update-weekly-completions`
  - 仅更新当前角色 `stats.completions.expedition/transcendence`，保留其余周统计字段不变。

### 当日追加（页面三栏布局重构）
- 主体从两栏改为三栏（`左 300 / 中主内容 / 右 340`，`xl` 断点启用）：
  - 左栏：账号与角色管理（保持原逻辑）。
  - 中栏：核心流程（总览、角色操作、任务打卡、设置）。
  - 右栏：次要与辅助（操作中心、倒计时、操作历史、待办提醒）。
- 信息分层优化：
  - 将“撤销/清空历史”控制从主内容区移入右栏。
  - 将“下一次恢复倒计时”和“操作历史日志”从中栏移入右栏，减少主流程纵向负担。
- 响应式调整：
  - 中栏关键卡片网格改为分级列数（2xl 扩展到 4 或 2 列），避免中等宽度挤压阅读。

### 当日追加（2K 全屏可读性优化）
- 中栏增加最大宽度并居中，限制超宽行长，降低“横向过长”阅读负担。
- 新增 `>=2200px` 的字体与控件微放大策略：
  - `text-xs / text-sm` 提升一档。
  - `pill-btn / task-btn` 字号与内边距同步增大。
  - 统计卡 `tile-k / tile-v` 略放大。

### 当日再调整（修复全屏三栏空隙过大）
- 将“中栏单独限宽”改为“整体三栏容器限宽”：
  - 三栏外层新增 `max-width` 并居中，避免 2K 全屏时两侧出现大块留白。
  - 中栏改为填满其列宽，不再单独居中限宽。
- 三栏轨道调整为：`300 / minmax(980, 1fr) / 340`，并将栏间距由 `gap-5` 收敛到 `gap-4`。

### 当日追加修订（按最新反馈精简 + 第 4/5 项启动）
- 精简顶部导航：
  - 删除“仪表盘”入口（避免重复）。
  - 导航顺序调整为：`角色总览 -> 角色操作 -> 设置页`。
- 回退“一键开打会话/作战笔记”方案：
  - 移除“开始本轮”按钮与相关数据结构、IPC、store 逻辑。
  - 回到“只保留进入角色路径”的简洁流程。
  - 状态版本回归 `v6`。
- 总览快捷操作（第 4 项）已落地：
  - 每个角色卡新增高频快捷按钮：`+远征券`、`远征-1`、`+超越券`、`超越-1`。
  - 可在总览直接完成部分高频动作，减少来回切换。
- 自动备份策略（第 5 项）已落地：
  - 每天首次读取状态时自动生成 1 份本地备份（无需手动弹窗）。
  - 备份目录：`文档/aion2-dashboard-auto-backups/`
  - 备份文件名：`aion2-dashboard-auto-时间戳.json`
  - 记录“当日已备份”元数据，确保同一天只自动备份一次。

### 本次校验
- 已执行 `npm run typecheck`，通过。

### 当日追加修正（按最新反馈校准）
- 远征/超越恢复时段整体后移 1 小时以匹配你实测：
  - 远征改为 `05:00 / 13:00 / 21:00`
  - 超越改为 `04:00 / 16:00`
- 设置页从“仪表盘内嵌模块”改为“独立 Tab 页面”。
- 新增“清空历史日志”按钮（与撤销入口并列）。
- 每日副本补齐：
  - 支持吃券（券库存录入）
  - 支持手动设定（基础次数 + 券库存）
- 升级状态版本到 `v4`，增加旧数据兼容迁移：
  - 将旧模型里“已包含券的每日副本剩余次数”自动还原为“基础次数”，避免升级后双重计数。
- 所有支持吃券的任务改为“输入数字批量录入”，不再固定 `+1`。
- 圣域“手动设定”弹窗增加字段说明（挑战剩余/开箱剩余含义与上限）。

### 当日二次追加（深渊回廊 + 金币单位）
- 金币展示与设置输入统一改为“万”为单位（内部仍按原始金币值存储）。
- 仪表盘倒计时新增“深渊回廊刷新”。
- “神器”文案统一改为“深渊回廊”。
- 深渊回廊改为全局同步模型：
  - 用户手动设定“本轮可打数量 + 下次时间（默认当前+48小时）”后，自动同步到所有角色。
  - 每个角色仅需录入“本角色完成了几个”，系统自动扣减该角色回廊剩余。
- 远征/超越恢复时段维持本次校准值：
  - 远征 `05:00 / 13:00 / 21:00`
  - 超越 `04:00 / 16:00`

### 当日三次追加（回廊交互修复）
- 修复“同步回廊（全角色）/回廊录入完成”点击反馈不明显问题：
  - 从 `prompt` 交互改为可见弹窗交互。
  - 增加设置页中的“深渊回廊参数（全局同步）”可视化表单，支持直接填写数量、下次时间、当前角色完成次数。
- 保留角色面板上的两个快捷按钮，但改为打开弹窗，不再“无感”。

### 当日四次追加（回廊双层化）
- 深渊回廊拆分为“下层回廊 / 中层回廊”两条独立通道：
  - 可打数量独立（各 0-3）
  - 刷新时间独立
- 回廊时间输入改为“倒计时托选”，不再输入日期：
  - 小时 `0-48`
  - 分钟 `0-60`
- 倒计时展示按 48 小时上限显示（回廊卡片展示固定为“上限 48 小时倒计时”说明）。
- 每角色录入完成时，可选择“下层 or 中层”并分别扣减该角色对应剩余次数。
- 状态版本升级到 `v5`，兼容读取旧字段 `artifactAvailable/artifactNextAt`（自动映射到下层回廊）。

### 当日五次追加（多账号 + 回廊隔离 + 新任务）
- 增加账号管理：
  - 支持新增/重命名/删除/切换账号。
  - 单账号最多 8 个角色（前后端双重校验）。
  - 新账号自动创建默认角色，避免账号空角色导致操作断链。
- 左侧角色管理重构为“账号 -> 角色”分层，新增角色默认进入当前账号。
- 深渊回廊同步从“全角色”改为“当前账号角色”：
  - 账号之间回廊数据互不影响。
  - 相关 IPC / preload / store / UI 全链路已对齐。
- 新增任务卡片：
  - 小游戏：`14/14`，每日 `+2`（05:00），支持券。
  - 精灵入侵：`7/7`，每日 `+1`（05:00），不支持券。
- 扩展手动设定：
  - 小游戏支持“基础次数 + 券次数”手动录入。
  - 保持每日副本/恶梦/觉醒/讨伐/远征/超越等手动设定一致性。
- 撤销能力补齐：
  - 撤销时同步恢复 `selectedAccountId` 与 `accounts` 快照，保证多账号状态回退一致。

### 当日六次追加（时段校准 + 任务卡片清理）
- 超越恢复时段按实测校准为：`05:00 / 17:00`。
- 周收益统计保留“每周三 05:00 自动重置”逻辑，并在 UI 增加显式提示。
- 使命类卡片简化：
  - 删除不可用占位按钮（如“不适用”）。
  - “录入已完成”文案统一为“输入已完成次数”。
- 任务分组和文案调整：
  - 每日副本归类到“周常任务”。
  - 吃券相关文案统一为“挑战券增加次数”。
  - 圣域并入“副本任务”区域，位于远征/超越之后一行。

### 当日七次追加（Dashboard 双层工作流）
- 新增 Dashboard 双模式：
  - 角色总览（默认进入）：先看全局可打情况。
  - 角色操作：点角色后进入沉浸式打卡与记录。
- 总览面板改造为“战前看板”：
  - 按账号分组展示角色卡片。
  - 所有核心项目统一为 `当前/总量` 形式（如 `每日副本 7/7`）。
  - 增加颜色分级：
    - 0 次：灰色
    - 低量：黄色
    - 高量：青色
  - 点击角色卡直接进入对应角色操作视图，形成“先总览 -> 再沉浸记录”的链路。

## 2026-02-12

### 今日完成（延续主链路，第 1 + 2 项）
- 总览看板新增排序/筛选：
  - 排序维度：可执行项 / 账号 / 大区。
  - 筛选维度：任务类型（全部/副本/周常/使命）、账号、大区（含“未设置大区”）。
  - 总览卡片改为统一列表展示，筛选结果为空时给出显式提示。
- 新增“一键开打会话”：
  - 在总览卡增加“开始本轮”按钮。
  - 一次点击完成：切换到目标角色 + 自动创建本轮笔记时间戳（持久化到角色数据）。
  - 角色操作页头部新增“本轮笔记起点”展示，确认会话已创建。

### 结构改动
- `src/shared/types.ts`
  - 新增 `BattleNote` 类型与 `CharacterState.battleNotes` 字段。
- `src/shared/constants.ts`
  - 状态版本升级到 `v7`。
  - 默认角色结构新增 `battleNotes: []`。
- `src/main/store.ts`
  - 新增 battle notes 归一化逻辑（兼容旧数据、限长、按时间排序）。
  - 新增 `startCharacterSession(characterId)` 状态操作。
- `src/shared/ipc.ts` / `src/main/ipc.ts` / `src/preload/index.ts`
  - 新增 IPC 通道：`character:start-session`。
- `src/renderer/src/App.tsx`
  - 总览筛选/排序控件接入。
  - 总览卡新增“进入角色 / 开始本轮”双操作。
  - 角色操作页显示最新本轮会话时间戳。

### 校验
- 已执行 `npm run typecheck`，通过。
